<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Content Management</title>
        <!-- CSS -->
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
            crossorigin="anonymous"
        />
        <link href="<%= url %>assets/style.css" rel="stylesheet" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
            rel="stylesheet"
        />

        <link
            href="<%= url %>assets/editor/summernote-bs4.css"
            rel="stylesheet"
        />
        <link href="<%= url %>assets/style.css" rel="stylesheet" />
        <link href="<%= url %>assets/dropify/dropify.css" rel="stylesheet" />
        <link
            rel="icon"
            type="image/x-icon"
            href="<%= url %>assets/img/icon.png"
        />
        <!-- JS -->
        <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"
        ></script>
        <script
            src="<%= url %>assets/editor/summernote-bs4.js"
            type="text/javascript"
        ></script>
        <script
            src="<%= url %>assets/editor/plugin.js"
            type="text/javascript"
        ></script>
        <script
            src="<%= url %>assets/dropify/dropify.js"
            type="text/javascript"
        ></script>
        <script>
            $(window).on("load", function () {
                $("#loading").hide();
            });
        </script>
    </head>
    <body>
        <div id="loading">
            <img
                id="loading-image"
                src="<%= url %>assets/img/icon.png"
                alt="Loading..."
                width="192px"
            />
        </div>

        <%- include('partial/navbar.ejs') %>

        <section class="mt-4 pb-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="<%= url %>app">Home</a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="<%= url %>app/article">Article</a>
                                </li>
                                <li
                                    class="breadcrumb-item active"
                                    aria-current="page"
                                >
                                    New
                                </li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
            <div class="container">
                <form action="<%= url %>app/article/save" method="POST">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <input
                                    id="title"
                                    type="text"
                                    name="title"
                                    class="form-control"
                                    id="exampleFormControlInput1"
                                    placeholder="Type the title article here"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <input
                                    id="slug"
                                    type="text"
                                    name="slug"
                                    class="form-control"
                                    id="exampleFormControlInput2"
                                    style="color: blue"
                                    placeholder="Slug or URL Canonical"
                                    required
                                />
                            </div>
                            <textarea name="content" id="summernote"></textarea>
                        </div>
                        <div class="col-md-4">
                            <!-- <div class="input-group">
                            <input type="file" name="image" id="dropify" class="dropify"/>
                        </div> -->
                            <div class="form-group">
                                <!-- <label for="exampleFormControlSelect1">Category</label> -->
                                <select
                                    class="form-control"
                                    name="category"
                                    id="exampleFormControlSelect1"
                                    required
                                >
                                    <option disabled selected value>
                                        Select Category
                                    </option>
                                    <% category.forEach(function(data) { %>
                                    <option value="<%= data.category_id %>">
                                        <%= data.category_name %>
                                    </option>
                                    <% }); %>
                                </select>
                            </div>
                            <label for="exampleFormControlSelect1">Tags</label>
                            <div
                                style="
                                    overflow-y: scroll;
                                    height: 150px;
                                    margin-bottom: 30px;
                                "
                            >
                                <% tags.forEach(function(data) { %>
                                <div class="form-check">
                                    <input
                                        class="form-check-input"
                                        name="tag[]"
                                        type="checkbox"
                                        value="<%= data.tagar_name %>"
                                        id="<%= data.tagar_id %>"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="<%= data.tagar_id %>"
                                    >
                                        <%= data.tagar_name %>
                                    </label>
                                </div>
                                <% }); %>
                            </div>
                            <div class="form-group mt-3">
                                <label for="exampleFormControlTextarea1"
                                    >Meta Description</label
                                >
                                <textarea
                                    name="metadesc"
                                    class="form-control"
                                    id="exampleFormControlTextarea1"
                                    rows="3"
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label for="exampleFormControlTextarea1"
                                    >Keyword</label
                                >
                                <textarea
                                    name="metakey"
                                    class="form-control"
                                    id="exampleFormControlTextarea1"
                                    rows="3"
                                ></textarea>
                            </div>
                            <div class="form-check form-check-inline">
                                <input
                                    name="status"
                                    class="form-check-input"
                                    type="radio"
                                    name="inlineRadioOptions"
                                    id="inlineRadio1"
                                    value="1"
                                />
                                <label
                                    class="form-check-label"
                                    for="inlineRadio1"
                                    >Private</label
                                >
                            </div>
                            <div class="form-check form-check-inline">
                                <input
                                    name="status"
                                    class="form-check-input"
                                    type="radio"
                                    name="inlineRadioOptions"
                                    id="inlineRadio2"
                                    value="0"
                                    checked
                                />
                                <label
                                    class="form-check-label"
                                    for="inlineRadio2"
                                    >Public</label
                                >
                            </div>
                            <div class="mt-3">
                                <button
                                    type="submit"
                                    class="btn btn-block btn-primary"
                                >
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </section>
        <div class="btn-additional btn-group-vertical">
            <button
                title="Snipped Code"
                type="button"
                class="btn btn-secondary"
                data-toggle="modal"
                data-target="#code"
            >
                <i class="fa fa-code-fork"></i>
            </button>
            <button
                title="Style Guide"
                type="button"
                class="btn btn-secondary"
                data-toggle="modal"
                data-target="#stylecopy"
            >
                <i class="fa fa-file"></i>
            </button>
        </div>
        <form>
            <div
                class="modal fade"
                id="code"
                tabindex="-1"
                role="dialog"
                aria-labelledby="thumb"
                aria-hidden="true"
            >
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Snipped Code</h5>
                            <button
                                type="button"
                                class="close"
                                data-dismiss="modal"
                                aria-label="Close"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="input-group">
                                <select
                                    class="form-control"
                                    name="language"
                                    id="language"
                                    required
                                >
                                    <option disabled selected value>
                                        Select Language
                                    </option>
                                    <option value="html">
                                        Markup / HTML / XML / RSS
                                    </option>
                                    <option value="css">CSS</option>
                                    <option value="js">Javascript</option>
                                    <option value="bash">Bash</option>
                                    <option value="json">JSON</option>
                                    <option value="php">PHP</option>
                                    <option value="ts">Typescript</option>
                                    <option value="sql">SQL</option>
                                    <option value="basic">Basic</option>
                                </select>
                            </div>
                            <div class="input-group mt-2">
                                <textarea
                                    id="codex"
                                    name="codex"
                                    rows="5"
                                    class="form-control"
                                ></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-dismiss="modal"
                            >
                                Close
                            </button>
                            <button
                                id="generate"
                                data-dismiss="modal"
                                class="btn btn-primary"
                            >
                                Generate Code
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <form>
            <div
                class="modal fade"
                id="stylecopy"
                tabindex="-1"
                role="dialog"
                aria-labelledby="thumb"
                aria-hidden="true"
            >
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Style Guide</h5>
                            <button
                                type="button"
                                class="close"
                                data-dismiss="modal"
                                aria-label="Close"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <table width="100%">
                                <tr>
                                    <td>
                                        <code
                                            style="
                                                font-family: monospace;
                                                white-space: pre;
                                                color: white;
                                                margin: 1em 0;
                                                padding-left: 5px;
                                                padding-right: 5px;
                                                padding-top: 1px;
                                                padding-bottom: 1px;
                                                border-radius: 3px;
                                                background-color: rgb(2, 2, 78);
                                            "
                                            >disini</code
                                        >
                                    </td>
                                    <td>
                                        <textarea
                                            rows="5"
                                            onclick="this.focus();this.select()"
                                            readonly="readonly"
                                            class="form-control"
                                        >
<code style="font-family: monospace; white-space: pre;color:white;margin: 1em 0;padding-left:5px;padding-right:5px;padding-top:1px;padding-bottom:1px;border-radius:3px;background-color: rgb(2, 2, 78);">disini</code></textarea
                                        >
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="modal-footer"></div>
                    </div>
                </div>
            </div>
        </form>
        <script>
            $("#generate").click(function () {
                let sel = $("#language").val();
                let code = $("#codex").val();
                let escaped = $("<div>").text(code).html();
                let HTMLstring = `<pre><code class="language-${sel}">${escaped}</code></pre>`;
                $("#summernote").summernote("editor.saveRange");
                $("#summernote").summernote("editor.restoreRange");
                $("#summernote").summernote("editor.focus");
                $("#summernote").summernote("pasteHTML", HTMLstring);
            });
            $("#summernote").summernote({
                placeholder: "Type here your content...",
                tabsize: 2,
                toolbarContainer: ".my-toolbar",
                height: "490px",
                maxHeight: 490,
                prettifyHtml: false,
                imageTitle: {
                    specificAltField: true,
                },
                popover: {
                    image: [
                        [
                            "image",
                            [
                                "resizeFull",
                                "resizeHalf",
                                "resizeQuarter",
                                "resizeNone",
                            ],
                        ],
                        ["float", ["floatLeft", "floatRight", "floatNone"]],
                        ["remove", ["removeMedia"]],
                        ["custom", ["imageTitle"]],
                    ],
                    link: [["link", ["linkDialogShow", "unlink"]]],
                },
                toolbar: [
                    ["style", ["style"]],
                    ["font", ["bold", "underline", "clear"]],
                    ["color", ["color"]],
                    ["para", ["ul", "ol", "paragraph"]],
                    ["table", ["table"]],
                    ["insert", ["link", "picture", "video"]],
                    ["view", ["fullscreen", "codeview", "help"]],
                ],
                callbacks: {
                    onImageUpload: function (image) {
                        uploadImage(image[0]);
                    },
                    onMediaDelete: function (target) {
                        deleteImage(target[0].src);
                    },
                },
            });
            $(".dropify").dropify({
                messages: {
                    default: "Upload Thumbnail",
                    replace: "Drag and drop or click to replace",
                    remove: "Remove",
                    error: "Ooops, something wrong happended.",
                },
            });
            function uploadImage(image) {
                var data = new FormData();
                data.append("image", image);
                $.ajax({
                    url: "<%= url %>app/article/upload-images",
                    cache: false,
                    contentType: false,
                    processData: false,
                    data: data,
                    type: "POST",
                    success: function (url) {
                        console.log(url);
                        $("#summernote").summernote("insertImage", url);
                    },
                    error: function (data) {
                        console.log(data);
                    },
                });
            }

            function deleteImage(src) {
                console.log(src);
                $.ajax({
                    url: "<%= url %>app/article/delete-images",
                    data: { src: src },
                    type: "POST",
                    success: function (response) {
                        console.log(response);
                    },
                    error: function (data) {
                        console.log(data);
                    },
                });
            }

            $("#title").keyup(function () {
                var title = $(this)
                    .val()
                    .toLowerCase()
                    .replace(/[&\/\\#^, +()$~%.'":*?<>{}]/g, "-");
                $("#slug").val(title);
            });
        </script>
        <style>
            /* .note-toolbar {
            position: fixed;
            top: 100px;
            z-index: 2;
        } */
        </style>
    </body>
</html>
